<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paradise Park â€” Wednesday 6's Season 1 2025</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0c0f14; --surface:#141820; --surface2:#1a1f2a; --border:#252b38;
  --text:#e8eaf0; --text-dim:#7a8194; --accent:#4ade80;
  --accent-glow:rgba(74,222,128,0.15); --highlight:#fbbf24;
  --highlight-bg:rgba(251,191,36,0.08); --red:#f87171;
  --win:#4ade80; --loss:#f87171; --draw:#a78bfa;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; overflow-x:hidden; }
.noise-overlay { position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events:none; z-index:9999; }
.app { max-width:960px; margin:0 auto; padding:2rem 1.5rem 4rem; }
header { margin-bottom:2.5rem; position:relative; }
header::after { content:''; position:absolute; bottom:-1.25rem; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); }
.league-badge { display:inline-flex; align-items:center; gap:0.4rem; font-family:'JetBrains Mono',monospace; font-size:0.7rem; font-weight:500; letter-spacing:0.08em; text-transform:uppercase; color:var(--accent); background:var(--accent-glow); padding:0.3rem 0.65rem; border-radius:4px; margin-bottom:0.75rem; border:1px solid rgba(74,222,128,0.15); }
h1 { font-family:'DM Serif Display',serif; font-size:2rem; font-weight:400; letter-spacing:-0.02em; line-height:1.15; }
h1 em { font-style:italic; color:var(--text-dim); font-size:0.85em; }
.subtitle { color:var(--text-dim); font-size:0.85rem; margin-top:0.35rem; }
.controls { display:flex; flex-wrap:wrap; gap:1rem; margin-bottom:1.75rem; align-items:flex-end; }
.control-group { flex:1; min-width:200px; }
.control-group label { display:block; font-family:'JetBrains Mono',monospace; font-size:0.65rem; font-weight:500; letter-spacing:0.1em; text-transform:uppercase; color:var(--text-dim); margin-bottom:0.4rem; }
.gw-slider-wrapper { display:flex; align-items:center; gap:0.6rem; }
.gw-btn, .play-btn { width:32px; height:32px; display:flex; align-items:center; justify-content:center; background:var(--surface); border:1px solid var(--border); border-radius:6px; cursor:pointer; transition:all 0.15s; flex-shrink:0; }
.gw-btn { color:var(--text-dim); font-size:0.9rem; }
.gw-btn:hover { background:var(--surface2); color:var(--text); border-color:var(--text-dim); }
.gw-btn:disabled { opacity:0.3; cursor:not-allowed; }
.play-btn { color:var(--accent); }
.play-btn:hover { background:var(--surface2); border-color:var(--accent); }
.play-btn.playing { background:var(--accent-glow); border-color:var(--accent); }
.play-btn svg { width:14px; height:14px; fill:currentColor; }
.gw-display { font-family:'JetBrains Mono',monospace; font-size:0.85rem; font-weight:600; color:var(--text); background:var(--surface); border:1px solid var(--border); border-radius:6px; padding:0.4rem 0.85rem; min-width:110px; text-align:center; user-select:none; }
.gw-display .date { font-size:0.7rem; font-weight:400; color:var(--text-dim); display:block; margin-top:1px; }
.gw-track { flex:1; height:4px; background:var(--surface2); border-radius:2px; position:relative; cursor:pointer; }
.gw-track-fill { height:100%; background:var(--accent); border-radius:2px; transition:width 0.2s; }
.gw-track-dots { position:absolute; top:50%; left:0; right:0; display:flex; justify-content:space-between; transform:translateY(-50%); pointer-events:none; }
.gw-dot { width:8px; height:8px; border-radius:50%; background:var(--surface2); border:2px solid var(--border); transition:all 0.2s; pointer-events:auto; cursor:pointer; }
.gw-dot.active { background:var(--accent); border-color:var(--accent); box-shadow:0 0 8px var(--accent-glow); }
.gw-dot.passed { background:var(--border); }
.share-btn { display:inline-flex; align-items:center; gap:0.35rem; font-family:'JetBrains Mono',monospace; font-size:0.65rem; font-weight:500; letter-spacing:0.05em; text-transform:uppercase; background:var(--surface); border:1px solid var(--border); border-radius:6px; color:var(--text-dim); padding:0.4rem 0.7rem; cursor:pointer; transition:all 0.15s; white-space:nowrap; }
.share-btn:hover { background:var(--surface2); color:var(--text); border-color:var(--text-dim); }
.share-btn.copied { border-color:var(--accent); color:var(--accent); }
.share-btn svg { width:12px; height:12px; stroke:currentColor; fill:none; stroke-width:2; }
.team-select { width:100%; padding:0.45rem 0.75rem; background:var(--surface); border:1px solid var(--border); border-radius:6px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.85rem; cursor:pointer; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%237a8194' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 0.6rem center; padding-right:2rem; }
.team-select:focus { outline:none; border-color:var(--highlight); }
.team-select option { background:var(--surface); }
.chart-panel { background:var(--surface); border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-bottom:1.75rem; }
.chart-header { padding:0.75rem 1rem; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:0.75rem; }
.chart-header h3 { font-family:'DM Serif Display',serif; font-weight:400; font-size:1.05rem; white-space:nowrap; }
.chart-controls { display:flex; align-items:center; gap:0.5rem; }
.chart-note { font-family:'JetBrains Mono',monospace; font-size:0.6rem; color:var(--text-dim); white-space:nowrap; }
.chart-toggle { display:inline-flex; background:var(--bg); border-radius:6px; overflow:hidden; border:1px solid var(--border); }
.chart-toggle button { font-family:'JetBrains Mono',monospace; font-size:0.65rem; font-weight:500; padding:0.3rem 0.65rem; background:transparent; border:none; color:var(--text-dim); cursor:pointer; transition:all 0.15s; white-space:nowrap; }
.chart-toggle button:hover { color:var(--text); }
.chart-toggle button.active { background:var(--surface2); color:var(--text); }
.chart-body { padding:1rem 0.5rem 0.5rem; position:relative; }
#posChart { width:100%; display:block; cursor:crosshair; }
.chart-tooltip { position:absolute; pointer-events:none; background:#1e2433; border:1px solid var(--border); border-radius:6px; padding:0.35rem 0.6rem; font-family:'DM Sans',sans-serif; font-size:0.75rem; font-weight:600; color:var(--text); white-space:nowrap; opacity:0; transition:opacity 0.12s; z-index:10; box-shadow:0 4px 12px rgba(0,0,0,0.4); transform:translate(-50%,-100%); margin-top:-10px; }
.chart-tooltip.visible { opacity:1; }
.chart-tooltip .tt-pos { font-family:'JetBrains Mono',monospace; font-size:0.65rem; color:var(--text-dim); font-weight:400; margin-left:0.3rem; }
.chart-tooltip .tt-dot { display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:0.35rem; vertical-align:middle; }
.table-wrapper { background:var(--surface); border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-bottom:1.75rem; }
table { width:100%; border-collapse:collapse; font-size:0.82rem; }
thead th { font-family:'JetBrains Mono',monospace; font-size:0.65rem; font-weight:500; letter-spacing:0.08em; text-transform:uppercase; color:var(--text-dim); padding:0.75rem 0.5rem; text-align:center; border-bottom:1px solid var(--border); position:sticky; top:0; background:var(--surface); z-index:2; }
thead th:nth-child(2) { text-align:left; }
tbody tr { transition:all 0.2s; border-bottom:1px solid rgba(37,43,56,0.5); }
tbody tr:last-child { border-bottom:none; }
tbody tr:hover { background:var(--surface2); }
tbody td { padding:0.65rem 0.5rem; text-align:center; font-variant-numeric:tabular-nums; }
tbody td:nth-child(1) { font-family:'JetBrains Mono',monospace; font-weight:600; font-size:0.75rem; color:var(--text-dim); width:36px; }
tbody td:nth-child(2) { text-align:left; font-weight:600; padding-left:0.5rem; white-space:nowrap; }
.pts-cell { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:0.9rem; }
.gd-positive { color:var(--accent); } .gd-negative { color:var(--red); } .gd-zero { color:var(--text-dim); }
tr.highlighted { background:var(--highlight-bg) !important; }
tr.highlighted td { color:var(--text); }
tr.highlighted td:nth-child(2) { color:var(--highlight); }
tr.highlighted td:nth-child(1) { color:var(--highlight); }
.pos-change { font-family:'JetBrains Mono',monospace; font-size:0.6rem; margin-left:0.3rem; font-weight:600; }
.pos-up { color:var(--accent); } .pos-down { color:var(--red); } .pos-same { color:var(--text-dim); }
.form-badges { display:flex; gap:3px; justify-content:center; }
.form-badge { width:18px; height:18px; border-radius:3px; display:flex; align-items:center; justify-content:center; font-family:'JetBrains Mono',monospace; font-size:0.55rem; font-weight:700; }
.form-badge.W { background:var(--win); color:#0c0f14; }
.form-badge.D { background:var(--draw); color:#0c0f14; }
.form-badge.L { background:var(--loss); color:#0c0f14; }
.results-panel { background:var(--surface); border:1px solid var(--border); border-radius:10px; overflow:hidden; }
.results-header { padding:0.75rem 1rem; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
.results-header h3 { font-family:'DM Serif Display',serif; font-weight:400; font-size:1.05rem; }
.results-date { font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--text-dim); }
.match-list { padding:0.5rem 0; }
.match-row { display:grid; grid-template-columns:1fr auto 1fr; align-items:center; padding:0.55rem 1rem; gap:0.75rem; transition:background 0.15s; }
.match-row:hover { background:var(--surface2); }
.match-row.match-highlighted { background:var(--highlight-bg); }
.team-home { text-align:right; font-size:0.82rem; font-weight:500; }
.team-away { text-align:left; font-size:0.82rem; font-weight:500; }
.match-score { font-family:'JetBrains Mono',monospace; font-weight:700; font-size:0.95rem; display:flex; align-items:center; gap:0.35rem; color:var(--text); background:var(--surface2); padding:0.2rem 0.55rem; border-radius:4px; min-width:52px; justify-content:center; }
.score-sep { color:var(--text-dim); font-size:0.7rem; }
.team-name-highlighted { color:var(--highlight); font-weight:700; }
.footer-bar { display:flex; align-items:center; justify-content:center; gap:1rem; margin-top:0.75rem; flex-wrap:wrap; }
.keyboard-hint { font-family:'JetBrains Mono',monospace; font-size:0.6rem; color:var(--text-dim); opacity:0.6; }
kbd { background:var(--surface2); border:1px solid var(--border); border-radius:3px; padding:0.1rem 0.35rem; font-size:0.6rem; }
.toast { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%) translateY(20px); background:#1e2433; border:1px solid var(--accent); border-radius:8px; padding:0.6rem 1.2rem; font-size:0.82rem; font-weight:500; color:var(--accent); box-shadow:0 8px 24px rgba(0,0,0,0.4); opacity:0; transition:all 0.3s ease; pointer-events:none; z-index:100; }
.toast.visible { opacity:1; transform:translateX(-50%) translateY(0); }
@media(max-width:640px) { .app{padding:1.25rem 1rem 3rem} h1{font-size:1.5rem} table{font-size:0.75rem} thead th,tbody td{padding:0.5rem 0.3rem} .hide-mobile{display:none} .match-row{padding:0.5rem 0.65rem} .team-home,.team-away{font-size:0.75rem} .chart-header{flex-wrap:wrap;gap:0.5rem} }
</style>
</head>
<body>
<div class="noise-overlay"></div>
<div class="app">
<header>
  <div class="league-badge"><span>&#9917;</span> PlayFootball</div>
  <h1>Paradise Park <em>Wednesday 6's</em></h1>
  <div class="subtitle">Premier League &mdash; Season 1 2025/26</div>
</header>
<div class="controls">
  <div class="control-group" style="flex:2">
    <label>Gameweek</label>
    <div class="gw-slider-wrapper">
      <button class="play-btn" id="play-btn" title="Play season (Space)">
        <svg id="play-icon" viewBox="0 0 24 24"><polygon points="6,3 20,12 6,21"/></svg>
        <svg id="pause-icon" viewBox="0 0 24 24" style="display:none"><rect x="5" y="3" width="4" height="18"/><rect x="15" y="3" width="4" height="18"/></svg>
      </button>
      <button class="gw-btn" id="gw-prev">&#8249;</button>
      <div class="gw-display" id="gw-display">GW 1</div>
      <div class="gw-track" id="gw-track">
        <div class="gw-track-fill" id="gw-fill"></div>
        <div class="gw-track-dots" id="gw-dots"></div>
      </div>
      <button class="gw-btn" id="gw-next">&#8250;</button>
    </div>
  </div>
  <div class="control-group" style="flex:1">
    <label>Highlight Team</label>
    <select class="team-select" id="team-select"></select>
  </div>
</div>
<div class="chart-panel">
  <div class="chart-header">
    <h3 id="chart-title">Position History</h3>
    <div class="chart-controls">
      <span class="chart-note" id="chart-note">1st &#8593; &middot; 10th &#8595;</span>
      <div class="chart-toggle">
        <button id="btn-position" class="active">Position</button>
        <button id="btn-points">Points</button>
      </div>
    </div>
  </div>
  <div class="chart-body">
    <canvas id="posChart" height="260"></canvas>
    <div class="chart-tooltip" id="chart-tooltip"></div>
  </div>
</div>
<div class="table-wrapper">
  <table>
    <thead><tr><th>#</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th class="hide-mobile">GF</th><th class="hide-mobile">GA</th><th>GD</th><th>Pts</th><th class="hide-mobile">Form</th></tr></thead>
    <tbody id="table-body"></tbody>
  </table>
</div>
<div class="results-panel">
  <div class="results-header"><h3 id="results-title">Matchday Results</h3><span class="results-date" id="results-date"></span></div>
  <div class="match-list" id="match-list"></div>
</div>
<div class="footer-bar">
  <div class="keyboard-hint"><kbd>&#8592;</kbd> <kbd>&#8594;</kbd> navigate &middot; <kbd>Space</kbd> play/pause</div>
  <button class="share-btn" id="share-btn">
    <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>Share
  </button>
</div>
</div>
<div class="toast" id="toast">Link copied to clipboard!</div>
<script>
const R=[{d:"08/10/2025",m:[["255 United","Peffermill Rovers",4,7],["Chickypigs","Swamp Donkeys",4,3],["P.I.G.S FC","Palazzo FC",3,3],["Delamina Angels","Stomping Ground",5,2],["Barely Athletic FC (JM)","BOSSA NOVA",6,14]]},{d:"15/10/2025",m:[["BOSSA NOVA","Delamina Angels",6,2],["Peffermill Rovers","P.I.G.S FC",1,2],["Palazzo FC","Barely Athletic FC (JM)",2,2],["Swamp Donkeys","255 United",4,3],["Stomping Ground","Chickypigs",3,1]]},{d:"22/10/2025",m:[["255 United","Stomping Ground",6,2],["Swamp Donkeys","Peffermill Rovers",2,5],["Barely Athletic FC (JM)","P.I.G.S FC",2,4],["Chickypigs","BOSSA NOVA",2,5],["Delamina Angels","Palazzo FC",5,3]]},{d:"29/10/2025",m:[["BOSSA NOVA","255 United",5,8],["Stomping Ground","Swamp Donkeys",4,7],["Palazzo FC","Chickypigs",7,1],["P.I.G.S FC","Delamina Angels",5,4],["Peffermill Rovers","Barely Athletic FC (JM)",7,1]]},{d:"05/11/2025",m:[["BOSSA NOVA","Swamp Donkeys",2,2],["Chickypigs","P.I.G.S FC",1,3],["Peffermill Rovers","Stomping Ground",7,4],["255 United","Palazzo FC",0,6],["Barely Athletic FC (JM)","Delamina Angels",2,9]]},{d:"26/11/2025",m:[["P.I.G.S FC","255 United",4,8],["Stomping Ground","BOSSA NOVA",3,9],["Barely Athletic FC (JM)","Chickypigs",4,6],["Swamp Donkeys","Palazzo FC",0,8],["Delamina Angels","Peffermill Rovers",8,0]]},{d:"03/12/2025",m:[["Chickypigs","255 United",4,5],["Barely Athletic FC (JM)","Stomping Ground",5,4],["Palazzo FC","Peffermill Rovers",8,0],["Delamina Angels","Swamp Donkeys",0,8],["P.I.G.S FC","BOSSA NOVA",1,6]]},{d:"10/12/2025",m:[["BOSSA NOVA","Barely Athletic FC (JM)",15,1],["Swamp Donkeys","Chickypigs",3,4],["Palazzo FC","P.I.G.S FC",2,1],["Stomping Ground","Delamina Angels",1,8],["Peffermill Rovers","255 United",5,4]]},{d:"17/12/2025",m:[["Chickypigs","Stomping Ground",1,0],["255 United","Swamp Donkeys",3,5],["P.I.G.S FC","Peffermill Rovers",6,5],["Delamina Angels","BOSSA NOVA",3,6],["Barely Athletic FC (JM)","Palazzo FC",0,9]]},{d:"07/01/2026",m:[["P.I.G.S FC","Barely Athletic FC (JM)",5,2],["Peffermill Rovers","Swamp Donkeys",4,3],["Palazzo FC","Delamina Angels",5,2],["BOSSA NOVA","Chickypigs",12,3],["Stomping Ground","255 United",5,6]]},{d:"14/01/2026",m:[["255 United","BOSSA NOVA",1,10],["Swamp Donkeys","Stomping Ground",5,3],["Chickypigs","Palazzo FC",0,9],["Delamina Angels","P.I.G.S FC",4,6],["Barely Athletic FC (JM)","Peffermill Rovers",0,12]]},{d:"21/01/2026",m:[["Delamina Angels","Barely Athletic FC (JM)",14,1],["Swamp Donkeys","BOSSA NOVA",3,4],["Palazzo FC","255 United",6,2],["P.I.G.S FC","Chickypigs",4,2],["Stomping Ground","Peffermill Rovers",3,8]]},{d:"28/01/2026",m:[["255 United","P.I.G.S FC",3,10],["Chickypigs","Barely Athletic FC (JM)",12,5],["Peffermill Rovers","Delamina Angels",7,2],["Palazzo FC","Swamp Donkeys",5,4],["BOSSA NOVA","Stomping Ground",8,1]]},{d:"04/02/2026",m:[["Delamina Angels","Chickypigs",2,5],["Peffermill Rovers","BOSSA NOVA",4,2],["Swamp Donkeys","P.I.G.S FC",4,2],["Stomping Ground","Palazzo FC",2,8],["Barely Athletic FC (JM)","255 United",4,9]]}];
const results=R.map(r=>({date:r.d,matches:r.m.map(m=>({home:m[0],away:m[1],hg:m[2],ag:m[3]}))}));
const allTeams=["Palazzo FC","BOSSA NOVA","Peffermill Rovers","P.I.G.S FC","Swamp Donkeys","Delamina Angels","255 United","Chickypigs","Barely Athletic FC (JM)","Stomping Ground"];
const teamColors={"Palazzo FC":"#5b8def","BOSSA NOVA":"#e06c75","Peffermill Rovers":"#98c379","P.I.G.S FC":"#d19a66","Swamp Donkeys":"#56b6c2","Delamina Angels":"#c678dd","255 United":"#e5c07b","Chickypigs":"#be5046","Barely Athletic FC (JM)":"#7f848e","Stomping Ground":"#636d83"};

let currentGW=14, chartMode='position', hoveredTeam=null, playInterval=null, isPlaying=false;

// URL state
function readURL(){
  const p=new URLSearchParams(location.search);
  const g=parseInt(p.get('gw')); if(g>=1&&g<=14) currentGW=g;
  const c=p.get('chart'); if(c==='points') chartMode='points';
  return p.get('team');
}
function updateURL(){
  try{
    const p=new URLSearchParams();
    p.set('gw',currentGW);
    if(sel.value) p.set('team',sel.value);
    if(chartMode!=='position') p.set('chart',chartMode);
    history.replaceState(null,'',location.pathname+'?'+p);
  }catch(e){}
}

// Init
const sel=document.getElementById('team-select');
const urlTeam=readURL();
sel.innerHTML='<option value="">None</option>'+allTeams.map(t=>'<option value="'+t+'"'+(((urlTeam||'Peffermill Rovers')===t)?' selected':'')+'>'+t+'</option>').join('');
sel.addEventListener('change',()=>{if(isPlaying)stopPlay();render();});

if(chartMode==='points'){document.getElementById('btn-position').classList.remove('active');document.getElementById('btn-points').classList.add('active');}
document.getElementById('btn-position').addEventListener('click',()=>setChartMode('position'));
document.getElementById('btn-points').addEventListener('click',()=>setChartMode('points'));

const dots=document.getElementById('gw-dots');
for(let i=1;i<=14;i++){const d=document.createElement('div');d.className='gw-dot';d.onclick=()=>{currentGW=i;if(isPlaying)stopPlay();render();};dots.appendChild(d);}
document.getElementById('gw-prev').onclick=()=>changeGW(-1);
document.getElementById('gw-next').onclick=()=>changeGW(1);
document.getElementById('play-btn').onclick=togglePlay;
document.getElementById('share-btn').onclick=shareLink;

// Compute
function computeTable(n){
  const T={};allTeams.forEach(t=>{T[t]={name:t,p:0,w:0,d:0,l:0,gf:0,ga:0,gd:0,pts:0,form:[]};});
  for(let i=0;i<n;i++) results[i].matches.forEach(m=>{
    const h=T[m.home],a=T[m.away]; h.p++;a.p++; h.gf+=m.hg;h.ga+=m.ag;a.gf+=m.ag;a.ga+=m.hg;
    if(m.hg>m.ag){h.w++;h.pts+=3;a.l++;h.form.push('W');a.form.push('L');}
    else if(m.hg<m.ag){a.w++;a.pts+=3;h.l++;h.form.push('L');a.form.push('W');}
    else{h.d++;a.d++;h.pts++;a.pts++;h.form.push('D');a.form.push('D');}
  });
  Object.values(T).forEach(t=>t.gd=t.gf-t.ga);
  return Object.values(T).sort((a,b)=>b.pts-a.pts||b.gd-a.gd||b.gf-a.gf);
}
const hist={pos:{},pts:{}};
allTeams.forEach(t=>{hist.pos[t]=[];hist.pts[t]=[];});
for(let g=1;g<=14;g++){const tb=computeTable(g);tb.forEach((t,i)=>{hist.pos[t.name].push(i+1);hist.pts[t.name].push(t.pts);});}
const maxPts=Math.max(...allTeams.flatMap(t=>hist.pts[t]));

function fmtDate(s){const[d,m,y]=s.split('/');return parseInt(d)+' '+['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][m-1]+' '+y;}
function ord(n){const s=["th","st","nd","rd"],v=n%100;return n+(s[(v-20)%10]||s[v]||s[0]);}

// Chart mode
function setChartMode(mode){
  chartMode=mode;
  document.getElementById('btn-position').classList.toggle('active',mode==='position');
  document.getElementById('btn-points').classList.toggle('active',mode==='points');
  document.getElementById('chart-title').textContent=mode==='position'?'Position History':'Points History';
  document.getElementById('chart-note').textContent=mode==='position'?'1st \u2191 \u00b7 10th \u2193':'Cumulative points';
  updateURL();renderChart();
}

// Playback
function togglePlay(){
  if(isPlaying){stopPlay();return;}
  isPlaying=true;
  document.getElementById('play-icon').style.display='none';
  document.getElementById('pause-icon').style.display='block';
  document.getElementById('play-btn').classList.add('playing');
  if(currentGW>=14)currentGW=0;
  playInterval=setInterval(()=>{currentGW++;if(currentGW>14){stopPlay();return;}render();},800);
}
function stopPlay(){
  isPlaying=false;clearInterval(playInterval);
  document.getElementById('play-icon').style.display='block';
  document.getElementById('pause-icon').style.display='none';
  document.getElementById('play-btn').classList.remove('playing');
}

// Share
function shareLink(){
  updateURL();
  let url;
  try{ url=location.href; }catch(e){ url=''; }
  if(!url||url==='about:srcdoc'){
    const p=new URLSearchParams();
    p.set('gw',currentGW);
    if(sel.value) p.set('team',sel.value);
    if(chartMode!=='position') p.set('chart',chartMode);
    url='https://your-hosted-url.com/dashboard.html?'+p;
  }
  const fallback=()=>prompt('Copy this link:',url);
  try{
    navigator.clipboard.writeText(url).then(()=>{
      const b=document.getElementById('share-btn');b.classList.add('copied');b.textContent='\u2713 Copied!';
      document.getElementById('toast').classList.add('visible');
      setTimeout(()=>{document.getElementById('toast').classList.remove('visible');b.classList.remove('copied');b.innerHTML='<svg viewBox="0 0 24 24" style="stroke:currentColor;fill:none;stroke-width:2"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>Share';},2000);
    }).catch(fallback);
  }catch(e){fallback();}
}

function changeGW(d){const n=currentGW+d;if(n>=1&&n<=14){currentGW=n;if(isPlaying)stopPlay();render();}}

// Chart interaction
let geo={};
function cx(gw){return geo.pl+((gw-1)/13)*geo.cw;}
function cy(v){return chartMode==='position'?geo.pt+((v-1)/9)*geo.ch:geo.pt+geo.ch-(v/maxPts)*geo.ch;}
function gv(t,i){return chartMode==='position'?hist.pos[t][i]:hist.pts[t][i];}

function hitTest(mx,my){
  let best=null,bd=Infinity;
  allTeams.forEach(t=>{
    for(let i=0;i<currentGW;i++){
      const x=cx(i+1),y=cy(gv(t,i)),d=Math.hypot(mx-x,my-y);
      if(d<15&&d<bd){bd=d;best={team:t,gw:i+1,val:gv(t,i),x,y};}
    }
    for(let i=0;i<currentGW-1;i++){
      const x1=cx(i+1),y1=cy(gv(t,i)),x2=cx(i+2),y2=cy(gv(t,i+1));
      const dx=x2-x1,dy=y2-y1,l2=dx*dx+dy*dy;
      const s=l2?Math.max(0,Math.min(1,((mx-x1)*dx+(my-y1)*dy)/l2)):0;
      const d=Math.hypot(mx-(x1+s*dx),my-(y1+s*dy));
      if(d<10&&d<bd){bd=d;const g=Math.round(s)?i+2:i+1;best={team:t,gw:g,val:gv(t,g-1),x:mx,y:y1+s*dy};}
    }
  });
  return best;
}

const cvs=document.getElementById('posChart'),ttip=document.getElementById('chart-tooltip');
cvs.addEventListener('mousemove',e=>{
  const r=cvs.getBoundingClientRect(),mx=e.clientX-r.left,my=e.clientY-r.top,h=hitTest(mx,my);
  if(h&&h.team!==sel.value){
    hoveredTeam=h.team;cvs.style.cursor='pointer';
    const c=teamColors[h.team],lbl=chartMode==='position'?ord(h.val)+' \u00b7 GW'+h.gw:h.val+' pts \u00b7 GW'+h.gw;
    ttip.innerHTML='<span class="tt-dot" style="background:'+c+'"></span>'+h.team+'<span class="tt-pos">'+lbl+'</span>';
    ttip.classList.add('visible');
    const br=cvs.parentElement.getBoundingClientRect();
    ttip.style.left=(e.clientX-br.left)+'px';ttip.style.top=(e.clientY-br.top-10)+'px';
  }else{hoveredTeam=null;cvs.style.cursor='crosshair';ttip.classList.remove('visible');}
  renderChart();
});
cvs.addEventListener('mouseleave',()=>{hoveredTeam=null;ttip.classList.remove('visible');cvs.style.cursor='crosshair';renderChart();});
cvs.addEventListener('click',e=>{
  const r=cvs.getBoundingClientRect(),h=hitTest(e.clientX-r.left,e.clientY-r.top);
  if(h){sel.value=h.team;hoveredTeam=null;ttip.classList.remove('visible');render();}
});

// Render chart
function renderChart(){
  const c=cvs,ctx=c.getContext('2d'),dpr=devicePixelRatio||1;
  const W=c.parentElement.getBoundingClientRect().width,H=260;
  c.width=W*dpr;c.height=H*dpr;c.style.width=W+'px';c.style.height=H+'px';ctx.scale(dpr,dpr);
  const hl=sel.value,pl=32,pr=20,pt=16,pb=28,cw=W-pl-pr,ch=H-pt-pb;
  geo={pl,pr,pt,pb,cw,ch,W,H};
  ctx.clearRect(0,0,W,H);
  const gn=currentGW;
  function xg(g){return pl+((g-1)/13)*cw;}
  function yv(v){return chartMode==='position'?pt+((v-1)/9)*ch:pt+ch-(v/maxPts)*ch;}

  // Grid
  ctx.save();
  if(chartMode==='position'){
    for(let p=1;p<=10;p++){const y=yv(p);ctx.strokeStyle='rgba(37,43,56,0.6)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pl,y);ctx.lineTo(W-pr,y);ctx.stroke();ctx.fillStyle='#4a5168';ctx.font="500 9px 'JetBrains Mono',monospace";ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText(p,pl-8,y);}
  }else{
    const st=maxPts<=20?5:10;
    for(let p=0;p<=maxPts+st;p+=st){const y=yv(p);if(y<pt-5||y>pt+ch+5)continue;ctx.strokeStyle='rgba(37,43,56,0.6)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pl,y);ctx.lineTo(W-pr,y);ctx.stroke();ctx.fillStyle='#4a5168';ctx.font="500 9px 'JetBrains Mono',monospace";ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText(p,pl-8,y);}
  }
  for(let g=1;g<=14;g++){ctx.fillStyle=g<=gn?'#4a5168':'#2a2f3a';ctx.font="500 8px 'JetBrains Mono',monospace";ctx.textAlign='center';ctx.textBaseline='top';ctx.fillText(g,xg(g),H-pb+10);}
  // GW marker
  ctx.strokeStyle='rgba(251,191,36,0.12)';ctx.lineWidth=1;ctx.setLineDash([4,4]);ctx.beginPath();ctx.moveTo(xg(currentGW),pt);ctx.lineTo(xg(currentGW),pt+ch);ctx.stroke();ctx.setLineDash([]);ctx.restore();

  // Draw lines
  const order=allTeams.filter(t=>t!==hl&&t!==hoveredTeam);
  if(hoveredTeam&&hoveredTeam!==hl)order.push(hoveredTeam);
  if(hl)order.push(hl);

  order.forEach(tn=>{
    const isH=tn===hl,isV=tn===hoveredTeam&&!isH;
    const data=chartMode==='position'?hist.pos[tn]:hist.pts[tn];
    const col=isH?'#fbbf24':teamColors[tn];
    const al=isH?1:isV?0.7:0.18,lw=isH?2.5:isV?2:1.2;
    ctx.save();ctx.globalAlpha=al;ctx.strokeStyle=col;ctx.lineWidth=lw;ctx.lineJoin='round';ctx.lineCap='round';
    if(gn>=2){ctx.beginPath();for(let i=0;i<gn;i++){const x=xg(i+1),y=yv(data[i]);i?ctx.lineTo(x,y):ctx.moveTo(x,y);}ctx.stroke();}
    for(let i=0;i<gn;i++){
      const x=xg(i+1),y=yv(data[i]),ic=(i+1)===currentGW;
      const r=isH?(ic?5.5:3):isV?(ic?4.5:2.5):(ic?3.5:1.8);
      ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=col;
      ctx.globalAlpha=isH?1:isV?0.85:(ic?0.35:al);ctx.fill();
      if(isH&&ic){ctx.beginPath();ctx.arc(x,y,10,0,Math.PI*2);const g=ctx.createRadialGradient(x,y,2,x,y,10);g.addColorStop(0,'rgba(251,191,36,0.3)');g.addColorStop(1,'rgba(251,191,36,0)');ctx.fillStyle=g;ctx.globalAlpha=1;ctx.fill();}
    }
    if((isH||isV)&&gn>=1){const lx=xg(gn),ly=yv(data[gn-1]);ctx.globalAlpha=1;ctx.fillStyle=isH?'#fbbf24':col;ctx.font=(isH?'600':'500')+' 10px DM Sans,sans-serif';ctx.textBaseline='middle';if(lx+90<W){ctx.textAlign='left';ctx.fillText(tn,lx+10,ly);}else{ctx.textAlign='right';ctx.fillText(tn,lx-10,ly);}}
    ctx.restore();
  });
}

// Main render
function render(){
  updateURL();
  const tb=computeTable(currentGW),prev=currentGW>1?computeTable(currentGW-1):null;
  const hl=sel.value,gw=results[currentGW-1];
  const pp={};if(prev)prev.forEach((t,i)=>pp[t.name]=i+1);

  document.getElementById('gw-display').innerHTML='GW '+currentGW+'<span class="date">'+fmtDate(gw.date)+'</span>';
  document.getElementById('gw-prev').disabled=currentGW<=1;
  document.getElementById('gw-next').disabled=currentGW>=14;
  document.getElementById('gw-fill').style.width=((currentGW-1)/13*100)+'%';
  document.querySelectorAll('.gw-dot').forEach((d,i)=>{d.className='gw-dot';if(i+1===currentGW)d.classList.add('active');else if(i+1<currentGW)d.classList.add('passed');});

  const tbody=document.getElementById('table-body');tbody.innerHTML='';
  tb.forEach((t,idx)=>{
    const pos=idx+1,tr=document.createElement('tr');
    if(t.name===hl)tr.classList.add('highlighted');
    let pc='';
    if(prev){const p=pp[t.name]||pos,d=p-pos;pc=d>0?'<span class="pos-change pos-up">\u25b2'+d+'</span>':d<0?'<span class="pos-change pos-down">\u25bc'+(-d)+'</span>':'<span class="pos-change pos-same">\u2013</span>';}
    const fm=t.form.slice(-5).map(f=>'<div class="form-badge '+f+'">'+f+'</div>').join('');
    const gc=t.gd>0?'gd-positive':t.gd<0?'gd-negative':'gd-zero';
    tr.innerHTML='<td>'+pos+pc+'</td><td>'+t.name+'</td><td>'+t.p+'</td><td>'+t.w+'</td><td>'+t.d+'</td><td>'+t.l+'</td><td class="hide-mobile">'+t.gf+'</td><td class="hide-mobile">'+t.ga+'</td><td class="'+gc+'">'+(t.gd>0?'+':'')+t.gd+'</td><td class="pts-cell">'+t.pts+'</td><td class="hide-mobile"><div class="form-badges">'+fm+'</div></td>';
    tbody.appendChild(tr);
  });

  document.getElementById('results-title').textContent='Gameweek '+currentGW+' Results';
  document.getElementById('results-date').textContent=fmtDate(gw.date);
  const ml=document.getElementById('match-list');ml.innerHTML='';
  gw.matches.forEach(m=>{
    const hi=m.home===hl||m.away===hl,d=document.createElement('div');
    d.className='match-row'+(hi?' match-highlighted':'');
    d.innerHTML='<div class="team-home'+(m.home===hl?' team-name-highlighted':'')+'">'+m.home+'</div><div class="match-score">'+m.hg+' <span class="score-sep">\u2013</span> '+m.ag+'</div><div class="team-away'+(m.away===hl?' team-name-highlighted':'')+'">'+m.away+'</div>';
    ml.appendChild(d);
  });
  renderChart();
}

document.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')changeGW(-1);else if(e.key==='ArrowRight')changeGW(1);else if(e.key===' '){e.preventDefault();togglePlay();}});
window.addEventListener('resize',renderChart);
render();
</script>
</body>
</html>